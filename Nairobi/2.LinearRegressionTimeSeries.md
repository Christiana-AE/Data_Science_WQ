## Libraries

import matplotlib.pyplot as plt
import pandas as pd
import plotly.express as px
import pytz
from IPython.display import VimeoVideo
from pymongo import MongoClient
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error


## Prepare Data

- Task
Complete to the create a client to connect to the MongoDB server running at host on port 27017, assign the "air-quality" database to db,
and assign the "nairobi" connection to nairobi.


    client = MongoClient(host= host, port = 27017)
    db = client["air-quality"]
    nairobi = db["nairobi"]


------------------------------------------------------------------------------------------------------

- Task
Complete the wrangle function below so that the results from the database query are read into the DataFrame df. 
Be sure that the index of df is the "timestamp" from the results.

def wrangle(collection):
    results = collection.find(
        {"metadata.site": 29, "metadata.measurement": "P2"},
        projection={"P2": 1, "timestamp": 1, "_id": 0},
    )

    df = pd.DataFrame(results).set_index("timestamp")
    
    return df


------------------------------------------------------------------------------------------------------


- Task
Use your wrangle function to read the data from the nairobi collection into the DataFrame df

    df = wrangle(nairobi)
    df.head(10)

------------------------------------------------------------------------------------------------------

- Task

Add to your wrangle function so that the DatetimeIndex for df is localized to the correct timezone, "Africa/Nairobi". 
Don't forget to re-run all the cells above after you change the function.

*NOTE* When getting timezone data from MongoDb, by defualt the time is in UTC
We will need to convert the UTC timezone to local time - in this case, we need to ocnvert to Kenya timezone


def wrangle(collection):
    results = collection.find(
        {"metadata.site": 29, "metadata.measurement": "P2"},
        projection={"P2": 1, "timestamp": 1, "_id": 0},
    )

    df = pd.DataFrame(results).set_index("timestamp")

    #Localize timezone to be Nairobi instead of UTC
    
    df.index = df.index.tz_localize("UTC").tz_convert("Africa/Nairobi")
    
    return df


------------------------------------------------------------------------------------------------------

 
## Explore Data


- Task

Create a boxplot of the "P2" readings in df

    fig, ax = plt.subplots(figsize=(15, 6))
    df["P2"].plot(kind="box", vert=False, title="Distribution of PM2.5 Readings", ax=ax )

------------------------------------------------------------------------------------------------------

- Task
 
Add to your wrangle function so that all "P2" readings above 500 are dropped from the dataset. 
Don't forget to re-run all the cells above after you change the function.


